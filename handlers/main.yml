---

- name: restart postfix
  service:
    name: postfix
    state: restarted

- name: restart dovecot
  service:
    name: dovecot
    state: restarted

- name: restart opendkim
  service:
    name: opendkim
    state: restarted

- name: import sql postfix
  mysql_db:
    name: "{{ ansible_pdm_mailserver_db_database }}"
    state: import
    login_host: "{{ ansible_pdm_mailserver_db_host }}"
    login_user: "{{ ansible_pdm_mailserver_db_username }}"
    login_password: "{{ ansible_pdm_mailserver_db_password }}"
    target: /etc/postfix/import.sql
  notify: restart postfix

- name: import sql opendmarc
  mysql_db:
    name: "{{ ansible_pdm_mailserver_db_opendmarc_database }}"
    state: import
    login_host: "{{ ansible_pdm_mailserver_db_host }}"
    login_user: "{{ ansible_pdm_mailserver_db_opendmarc_username }}"
    login_password: "{{ ansible_pdm_mailserver_db_opendmarc_password }}"
    target: /usr/share/doc/opendmarc/schema.mysql
  notify: restart opendmarc

- name: restart opendmarc
  service:
    name: opendmarc
    state: restarted

- name: restart rspamd
  service:
    name: rspamd
    state: restarted

- name: reload nginx
  service:
    name: nginx
    state: reloaded
